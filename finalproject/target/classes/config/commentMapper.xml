<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
 <mapper namespace="comment">
   <insert id="cm_insert" parameterType="dto.CommentDTO">
		<selectKey resultType="int" keyProperty="cm_num" order="BEFORE">
			select b_comment_cm_num_seq.nextval from dual
		</selectKey>
		insert into b_comment
		values(#{cm_num},#{cm_content},#{board_b_num},#{user_id},sysdate,#{rate})
	</insert>
 
    <insert id="board_cm_insert" parameterType="dto.CommentDTO">
		<selectKey resultType="int" keyProperty="cm_num" order="BEFORE">
			select b_comment_cm_num_seq.nextval from dual
		</selectKey>
		insert into b_comment
		values(#{cm_num},#{cm_content},#{board_b_num},#{user_id},sysdate,0)
	</insert>
 
	<select id="cm_list" parameterType="int" resultType="dto.CommentDTO">
		select * from b_comment
		where board_b_num=#{board_b_num} order by cm_num desc
	</select>
	
	<select id="rateAvg" parameterType="int" resultType="double">
	   select COALESCE(avg(rate),0) from b_comment where board_b_num=#{b_num}
	</select>
	
	
	<delete id="cm_delete" parameterType="int" >
	  delete from b_comment
	  where cm_num=#{cm_num}
	</delete>
	
	<delete id="sug_cm_delete" parameterType="int" >
	  delete from b_comment
	  where board_b_num=#{b_num}
	</delete>
	
	<update id="cm_update" parameterType="dto.CommentDTO">
	  update b_comment set cm_content=#{cm_content}
	  where  cm_num=#{cm_num}
	</update>
 
 
 
 </mapper>